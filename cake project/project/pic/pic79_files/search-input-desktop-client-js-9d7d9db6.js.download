import"./faceplate-search-input-96f752d6.js";import{ce as e,_ as t,e as o,a6 as s}from"./shell-f4762685.js";import{x as r}from"./icon-6f6936c6.js";import{a,R as n,S as i}from"./base-d1a6e25e.js";import"./text-input-3a47a565.js";import"./filterNullish-6d330245.js";import"./constants-902ad97e.js";import"./validate-image-e3da41ac.js";import"./age-gate-standalone-client-js-94176c80.js";import"./search-telemetry-tracker-e9541b1c.js";import"./post-consume-tracker-be7475af.js";import"./links-27339dcb.js";import"./search-typeahead-expandable-section-f734a7b5.js";import"./search-params-c26530d2.js";import"./search-dynamic-id-1e0e9861.js";import"./expandable-section-header-c6bc0030.js";import"./ad-event-tracker-d6725d81.js";import"./with-ad-observer-ea1fe2f7.js";import"./errors-8d0111b7.js";import"./overflow-menu-actions-e34daab6.js";import"./distinguished-tags-c69e84dd.js";import"./shreddit-dynamic-ad-link-4045b677.js";import"./suggested-search-queries-client-js-4795809e.js";import"./faceplate-expandable-section-helper-cdebcb1f.js";import"./faceplate-auto-height-animator-6ae74235.js";import"./content-tags-b3fc0b1c.js";import"./pdp-seeker-cafdafe5.js";class h{constructor(t){this.onKeyDown=e=>{const t="Escape"===e.key,o="Tab"===e.key,s=Boolean(o&&this.host.shadowRoot&&this.host.input&&this.host.shadowRoot.activeElement===this.host.input),r=o&&!e.shiftKey;t&&e.preventDefault(),(t||s||r)&&this.host.handleBlur()},this.getKeyboardNavigableDropdownItems=()=>{const t=`[role="menuitem"],summary[aria-controls*="${e}"]`,o=[];return[this.host.suggestedSearchResultsContainer,this.host.recentSearchesContainer,this.host.trendingSearchesContainer,this.host.typeaheadResultsContainer].forEach((e=>{if(!e)return;e.querySelectorAll(t).forEach((e=>{const t=null!==e.offsetParent&&e.offsetHeight>0,s="SUMMARY"===e.tagName,r=e.closest("faceplate-expandable-section-helper");t&&(s||!r||r.open)&&o.push(e)}))})),o},this.handleRecentSearchTabKeyNavigation=e=>{const t=e.target.querySelector(".recent-search-item-delete-button");e.shiftKey&&e.target.className.includes("recent-search-item-delete-button")?(e.target.closest('[role="menuitem"]')?.focus(),e.preventDefault(),e.stopPropagation()):!e.shiftKey&&t&&(t.focus(),e.preventDefault(),e.stopPropagation())},this.handleDropdownKeyDown=e=>{const t=e.target?.closest(`#${a}`);if("Tab"===e.key&&t)this.handleRecentSearchTabKeyNavigation(e);else if("ArrowDown"===e.key||"ArrowUp"===e.key){e.preventDefault();const t=e.target,o=this.getKeyboardNavigableDropdownItems();let s=-1;o.forEach(((e,o)=>{e===t&&(s=o)}));const r="ArrowDown"===e.key?s+1:s-1,a=s>=0&&s<o.length?o[r]:void 0;a?a.focus():this.focusSearchInputWithArrowKeys()}},this.host=t}hostConnected(){this.host.addEventListener("keydown",this.onKeyDown)}hostDisconnected(){this.host.removeEventListener("keydown",this.onKeyDown)}handleKeyDown(e){if(!["ArrowDown","ArrowUp"].includes(e.key))return;e.preventDefault();const t=this.getKeyboardNavigableDropdownItems();0!==t.length&&("ArrowDown"===e.key?t[0].focus():"ArrowUp"===e.key&&t[t.length-1].focus())}focusSearchInputWithArrowKeys(){const e=this.host.input?.shadowRoot?.querySelector("input");e?.focus();const t=e?.value.length;t&&e?.setSelectionRange(t,t)}}let d=class extends n{constructor(){super(...arguments),this.handleDropdownKeyDown=e=>{super.handleDropdownKeyDown(e),this.keyboardNavigationController?.handleDropdownKeyDown(e)}}handleFocus(){super.handleFocus(),this.keyboardNavigationController||(this.keyboardNavigationController=new h(this),this.addController(this.keyboardNavigationController))}handleKeyDown(e){super.handleKeyDown(e),this.keyboardNavigationController?.handleKeyDown(e)}render(){return r` <div class="reddit-search-bar rounded-5 w-[inherit] box-border ${s({"shadow-sm":this.isFocused,"bg-neutral-background-strong":this.isFocused,"bg-secondary-background":!this.isFocused})}" data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}"> <div class="${s({"pb-[.5rem]":this.showDropdown&&!this.isSearchScopeEnabled,"pb-xs":this.showDropdown&&this.isSearchScopeEnabled,"border-b-sm":this.showDropdown,"border-t-0":this.showDropdown,"border-r-0":this.showDropdown,"border-l-0":this.showDropdown,"border-solid":this.showDropdown,"border-neutral-border-weak":this.showDropdown})}"> <form autocomplete="off" class="flex relative items-center text-neutral-content-strong" @submit="${this.handleSubmit}"> ${this.renderSearchInput(!0)} </form> </div> <div class="max-h-[calc(100vh-var(--shreddit-header-height)-15px-10px)] overflow-y-auto overflow-x-hidden m-t ${s({hidden:!this.showDropdown})}" id="${i}"> ${this.renderDropdownContent(!0)} </div> </div> `}};d=t([o("reddit-search-large")],d);
