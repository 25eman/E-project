import{b as e,ba as t,b8 as s,_ as o,g as i,n as a,e as n,E as r,b9 as c,bb as l,a_ as p,bc as h,bd as d}from"./shell-f4762685.js";import{A as m,r as u}from"./auth-flow-controller-d6f19647.js";import{G as g}from"./google-api-4ec76558.js";import{W as w}from"./with-recaptcha-f8f02e7c.js";import{p as f}from"./password-recovery-3b913c2d.js";import{O as C,J as y}from"./age-gate-standalone-client-js-94176c80.js";import{s as b}from"./icon-6f6936c6.js";import"./helpers-e3b61b93.js";const v=new Set(t.map((e=>s({source:C,action:y,noun:e})))),S=w(b);let A=class extends S{constructor(){super(...arguments),this.useCaptcha=!1,this.isEmailPermissionRequired=!1,this.hasCredentials=!1,this.googleApiController=new g(this,g.OneTapUX),this.authFlowController=new m(this),this.events=new r(this),this.showPrompt=async()=>{await this.googleApiController.initialize(),window.google?.accounts.id.prompt(this.momentListener)},this.onGoogleCredentialResponse=async e=>{let t;const{credential:s,select_by:o}=e;try{const i=g.parseCredentialResponse(e);this.captchaSiteKey&&this.useCaptcha&&(t=await this.getRecaptchaToken()),this.authFlowController.identityProviderSigin({authFlow:c.OneTap,email:i.email,idToken:s,isSignedInAutomatically:"auto"===o||"fedcm_auto"===o,provider:l.Google,recaptchaToken:t,recaptchaAction:this.captchaAction,emailPermissionRequired:this.isEmailPermissionRequired})}catch(e){window.Sentry?.captureException?.(e),this.authFlowController.trackSSOFailure({authFlow:c.OneTap,provider:l.Google,reason:"unknown"})}},this.momentListener=t=>{if(t.isDismissedMoment()){const s=t.getDismissedReason();"credential_returned"!==s&&console.error(`Google One Tap prompt was dismissed: ${s}`),p(this,function(t){return e({source:"onboarding",action:"dismiss",noun:"google_one_tap"},{action_info:{reason:t,success:"credential_returned"===t}})}(s))}},this.onFaceplateResponse=this.events.define("faceplate-response",(e=>{const{response:t}=e.detail,s=f(t.url)?.pathname;s===h.IdentityProviderSignin&&t.status!==d.MultipleAccountsFound&&t.status!==d.UserAccountCreated&&t.status!==d.UserLoggedIn&&this.dismiss()})),this.onFaceplateTrack=this.events.define("faceplate-track",(e=>{e.SAN&&v.has(e.SAN)&&this.dismiss()}))}connectedCallback(){super.connectedCallback(),this.showPrompt(),this.insertRecaptchaScript()}reloadThePage(){u()}dismiss(){this.parentNode?.removeChild(this)}};o([a({type:Boolean,attribute:"use-captcha"})],A.prototype,"useCaptcha",void 0),o([a({type:Boolean,attribute:"is-email-permission-required"})],A.prototype,"isEmailPermissionRequired",void 0),o([i()],A.prototype,"hasCredentials",void 0),A=o([n("auth-flow-google-one-tap-prompt")],A);
